/**
 * Angular feedback directive similar to Google Feedback
 * @version v2.0.0 - 2017-10-17 * @link https://github.com/pepperlabs/angular-feedback
 * @author Jacob Carter <jacob@ieksolutions.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("templates-angularsendfeedback",["angularsendfeedback.html","feedback-highlighter.html"]),angular.module("angularsendfeedback.html",[]).run(["$templateCache",function(a){a.put("angularsendfeedback.html","<div>\n  <div id=\"feedback-button\" ng-show='settings.feedbackButtonNative && feedbackButtonEnabled && !start'\n       ng-click='startFeedback()'>\n    <button class=\"feedback-btn feedback-btn-gray\">{{i10n.initButton}}</button>\n  </div>\n\n  <div id=\"feedback-module\" ng-if='start'>\n    <div id=\"feedback-welcome\" ng-if='showWelcome'>\n      <div class='feedback-top'>\n        <div class=\"feedback-logo\">{{i10n.title}}</div>\n        <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n      </div>\n      <p>{{i10n.welcome.message1}}</p>\n      <p>{{i10n.welcome.message2}}</p>\n      <textarea id=\"feedback-note-tmp\" ng-model=\"feedbackNote\"></textarea>\n      <p ng-show='settings.postCategory'>{{i10n.welcome.message4}}</p>\n      <select ng-options='cat for cat in settings.categories' ng-model='feedbackCategory'\n           ng-show='settings.postCategory' ng-init='feedbackCategory = settings.defaultCategory'></select>\n      <p>{{i10n.welcome.message3}}</p>\n      <div class='feedback-bottom'>\n        <div id=\"feedback-welcome-error\" ng-hide=\"feedbackNote\">{{i10n.descriptionError}}</div>\n        <button class=\"feedback-next-btn feedback-btn-gray\"\n                ng-click='launchHighlight(feedbackNote, feedbackCategory)' ng-disabled=\"!feedbackNote\">\n          {{i10n.nextButton}}\n        </button>\n      </div>\n    </div>\n\n    <div id=\"feedback-submit-error\" ng-if=\"submitError\">\n      <div class='feedback-top'>\n        <div class=\"feedback-logo\">{{i10n.title}}</div>\n        <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n      </div>\n      <p>{{i10n.networkError}}</p>\n      <button class=\"feedback-close-btn feedback-btn-blue\" ng-click='close()'>{{i10n.okButton}}</button>\n    </div>\n\n    <feedback-highlighter ng-show=\"showFeedbackHighlighter\" feedback-settings='settings'\n      next='takeScreenshot' prev='backToWelcome' toggle='setHighlight' close='close'>\n    </feedback-highlighter>\n\n    <div id=\"feedback-helpers\" ng-show='showFeedbackHelpers'>\n      <div ng-repeat=\"item in highlightblocks\" class=\"feedback-helper\"\n           ng-mouseover='item.showRemove = true' ng-mouseleave='item.showRemove = false'\n           ng-style=\"{'top': item.top + 'px','left': item.left + 'px',\n                      'width': item.width + 'px','height': item.height + 'px',\n                      'z-index': item.zIndex}\">\n"+'        <div class="feedback-close" ng-style="item.styleClose" ng-click="removeBlock($index)"\n            ng-show="item.showRemove"></div>\n      </div>\n    </div>\n\n    <div id="feedback-overview" ng-show="showOverview">\n      <div class=\'feedback-top\'>\n        <div class="feedback-logo">{{i10n.title}}</div>\n        <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n      </div>\n      <div id="feedback-overview-description">\n        <div id="feedback-overview-description-text">\n          <h3>Description</h3>\n          <textarea id="feedback-overview-note" ng-model="feedbackNote"></textarea>\n\n          <h3 class="feedback-additional">Additional info</h3>\n          <div id="feedback-additional-content">\n            <ul>\n              <li ng-show=\'!settings.postBrowserInfo&&!settings.pageInfo&&!settings.postHTML&&!settings.postTimeStamp\'>None</li>\n              <li ng-show=\'settings.postBrowserInfo\'>{{i10n.data.browser}}</li>\n              <li ng-show=\'settings.pageInfo\'>{{i10n.data.page}}</li>\n              <li ng-show=\'settings.postTimeStamp\'>{{i10n.data.time}}</li>\n              <li ng-show=\'settings.postHTML\'>{{i10n.data.structure}}</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div id="feedback-overview-screenshot">\n        <h3>Screenshot</h3>\n        <img class="feedback-screenshot" ng-src="{{screenshot}}"/>\n      </div>\n      <div class="feedback-buttons">\n        <button class="feedback-back-btn feedback-btn-gray" ng-click=\'backToHighlight()\'>{{i10n.backButton}}</button>\n        <button class="feedback-submit-btn feedback-btn-blue" ng-click="submit()">{{i10n.submitButton}}</button>\n      </div>\n      <div id="feedback-overview-error" ng-hide="feedbackNote">{{i10n.descriptionError}}</div>\n    </div>\n\n\n    <div id="feedback-submit-success" ng-if="submitSuccess">\n      <div class=\'feedback-top\'>\n        <div class="feedback-logo">{{i10n.title}}</div>\n        <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n      </div>\n      <p>{{i10n.thanks.message1}}</p>\n      <p>{{i10n.thanks.message2}}</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>{{i10n.okButton}}</button>\n    </div>\n  </div>\n  <canvas id="feedback-canvas" ng-mousemove=\'onHover($event)\' ng-mouseup=\'selectBlock($event)\'\n        ng-mousedown=\'onMouseDown($event)\' ng-mouseleave=\'redraw()\' ng-show=\'showCanvas\'></canvas>\n</div>\n')}]),angular.module("feedback-highlighter.html",[]).run(["$templateCache",function(a){a.put("feedback-highlighter.html","<div id=\"feedback-highlighter\" ng-mousedown='track($event)' ng-mouseup='untrack()' ng-mousemove='move($event)'\n     ng-class='{\"feedback-draggable\":dragging}' ng-style='style'>\n  <div class='feedback-top'>\n    <div class=\"feedback-logo\">{{i10n.title}}</div>\n    <div class=\"feedback-wizard-close\" ng-click='close()'></div>\n  </div>\n  <p>{{i10n.draw.message1}}</p>\n  <div class='feedback-highlight-container'>\n    <button class=\"feedback-sethighlight\" ng-mousedown='toggle(true)'\n            ng-class='{\"feedback-active\": toggle()}'>\n      <div class=\"ico\"></div>\n      <span>{{i10n.draw.highlightTitle}}</span>\n    </button>\n    <label>{{i10n.draw.highlight}}</label>\n  </div>\n  <div class='feedback-highlight-container'>\n    <button class=\"feedback-setblackout\" ng-mousedown='toggle(false)' ng-class='{\"feedback-active\": !toggle()}'>\n      <div class=\"ico\"></div>\n      <span>{{i10n.draw.blackoutTitle}}</span>\n    </button>\n    <label class=\"lower\">{{i10n.draw.blackout}}</label>\n  </div>\n  <div class=\"feedback-buttons\">\n    <button class=\"feedback-back-btn feedback-btn-gray\"\n      ng-click='prev()' ng-show='settings.initialBox'>{{i10n.backButton}}</button>\n    <button class=\"feedback-next-btn feedback-btn-gray\" ng-click='next()'>{{i10n.nextButton}}</button>\n  </div>\n</div>\n")}]),function(){"use strict";angular.module("angular-send-feedback",["templates-angularsendfeedback"]).directive("feedbackHighlighter",["$window",function(a){return{restrict:"E",scope:{settings:"=feedbackSettings",next:"=",prev:"=",toggle:"=",close:"="},templateUrl:function(a,b){return b.template||"feedback-highlighter.html"},link:function(a,b,c){a.i10n=a.settings.i10n[a.settings.language],b=b.children()[0],a.dragging=!1,a.style={};var d,e;a.move=function(c){if(a.settings.isDraggable&&a.dragging){var f=b.getBoundingClientRect();if(null===d)return d=c.pageX,void(e=c.pageY);var g=c.pageX-d,h=c.pageY-e;a.style.height=f.height+"px",a.style.width=f.width+"px",a.style.top=f.top+h+"px",a.style.left=f.left+g+"px",d=c.pageX,e=c.pageY}},a.track=function(b){a.settings.isDraggable&&(d=null,e=null,a.dragging=!0,b.preventDefault())},a.untrack=function(){a.dragging=!1};var f=angular.element(b);f.on("touchstart",a.track),f.on("touchend",a.untrack),f.on("touchmove",a.move)}}}])}(),function(){"use strict";function a(a,b){var c,d,e;d=!1,c=document.createElement("script"),c.type="text/javascript",c.src=a,c.onload=c.onreadystatechange=function(){d||this.readyState&&"complete"!==this.readyState||(d=!0,b())},e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(c,e)}function b(b,c,d){function e(e){function f(){var a=document.body.clientHeight,b=document.body.clientWidth;v.attr("width",b),v.attr("height",a)}function g(){e.showCanvas=!1,f(),angular.element(c).bind("resize",function(){f()})}function h(){t=!0,e.showCanvas=!0,e.showFeedbackHelpers=!0,e.showWelcome=!1,e.showFeedbackHighlighter=!0}function i(){t=!1,e.feedbackButtonEnabled=!0,e.showWelcome=!1,e.showOverview=!1,e.showFeedbackHelpers=!1,e.showFeedbackHighlighter=!1,e.highlightblocks.length=0,e.showCanvas=!1,e.start=!1,q.onClose.call(this)}function j(a,b){b="undefined"!=typeof b?b:!0,k(a),m(a),n(a),o(a)}function k(a){a.clearRect(0,0,v[0].offsetWidth,v[0].offsetHeight),a.fillStyle="rgba(102,102,102,0.5)",a.fillRect(0,0,v[0].offsetWidth,v[0].offsetHeight)}function l(a,b,c,d,e){a.strokeStyle=q.strokeStyle,a.shadowColor=q.shadowColor,a.shadowOffsetX=q.shadowOffsetX,a.shadowOffsetY=q.shadowOffsetY,a.shadowBlur=q.shadowBlur,a.lineJoin=q.lineJoin,a.lineWidth=q.lineWidth,a.strokeRect(b,c,d,e),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}function m(a){var b,c;for(c=0;c<e.highlightblocks.length;c++)b=e.highlightblocks[c],"highlight"===b.type&&l(a,b.left,b.top,b.width,b.height)}function n(a){var b,c;for(c=0;c<e.highlightblocks.length;c++)b=e.highlightblocks[c],"highlight"===b.type&&a.clearRect(b.left,b.top,b.width,b.height)}function o(a){var b,c;for(c=0;c<e.highlightblocks.length;c++)b=e.highlightblocks[c],"blackout"===b.type&&(b.pending?a.fillStyle="rgba(0,0,0,0.5)":a.fillStyle="rgba(0,0,0,1)",a.fillRect(b.left,b.top,b.width,b.height))}var p=e.options,q=angular.extend({ajaxURL:"",postBrowserInfo:!0,postHTML:!0,postURL:!0,postTimeStamp:!0,proxy:void 0,letterRendering:!1,initButtonText:"Send feedback",strokeStyle:"black",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:3,html2canvasURL:"html2canvas.js",feedbackButton:".feedback-btn",feedbackButtonNative:!0,showDescriptionModal:!0,isDraggable:!0,postCategory:!0,categories:["Suggestion","Bug report","Product error","Other"],defaultCategory:"Suggestion",excludeTags:["body","script","iframe","div","section","canvas",".feedback-btn","#feedback-module"],onScreenshotTaken:function(){},language:"fr",i10n:{en:{title:"Feedback",initButton:"Send feedback",submitButton:"Submit",nextButton:"Next",okButton:"OK",backButton:"Back",descriptionError:"Please enter a description",networkError:"Sadly an error occurred while sending your feedback. Please try again.",welcome:{message1:"Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.",message2:"Start by writing a brief description:",message3:"Next we'll let you identify areas of the page related to your description.",message4:"Please indicate the category of your feedback, it helps up organize feedbacks."},thanks:{message1:"Thank you for your feedback. We value every piece of feedback we receive.",message2:"We cannot respond individually to every one, but we will use your comments as we strive to improve your experience."},draw:{message1:"Click and drag on the page to help us better understand your feedback.You can move this dialog if it's in the way.",highlightTitle:"Highlight",highlight:"Highlight areas relevant to your feedback.",blackoutTitle:"Black out",blackout:"Black out any personal information."},data:{browser:"Browser Info",page:"Page Info",time:"Time Stamp",structure:"Page Structure"}},fr:{title:"Avis",initButton:"Un avis ?",submitButton:"Envoyer",nextButton:"Suivant",okButton:"OK",backButton:"Retour",descriptionError:"Veuillez entrer une description",networkError:"Malheureusement une erreur s'est produite pendant l'envoi de votre avis. Veuillez réessayer.",welcome:{message1:"Les avis vous permettent de nous envoyer des suggestions à propos de notre site. Nous accueillons les rapports d'erreurs, idées de fonctionnalités et commentaires généraux",message2:"Commencez par rédiger une brève description:",message3:"Par la suite, nous vous laisserons identifier les zones de la page correspondant à votre description",message4:"À quelle catégorie correspond votre retour ?"},thanks:{message1:"Merci pour votre retour. Nous analysons chaque avis que nous recevons.",message2:"Nous ne pouvons pas répondre à tous les commentaires, mais sachez qu'ils sont toujours pris en compte."},draw:{message1:"Cliquez et glissez votre curseur sur la page pour nous aider à mieux comprendre votre avis",highlightTitle:"Surligner",highlight:"Surlignez les zones pertinentes",blackoutTitle:"Masquer",blackout:"Masquez vos informations personnelles"},data:{browser:"Informations sur votre navigateur",page:"Informations sur la page",time:"Date du jour",structure:"Structure de la page"}}},onClose:function(){},screenshotStroke:!0,highlightElement:!0,initialBox:!0},p);e.i10n=q.i10n[q.language],e.settings=q;var r=!!window.HTMLCanvasElement,s=".feedback-btn"===q.feedbackButton;e.highlightblocks=[];var t;if(r){var u=angular.element(b);e.feedbackButtonEnabled=!0,e.feedbackNote="",e.feedbackCategory="",e.start=!1;var v=angular.element(document.getElementById("feedback-canvas"));e.launchHighlight=function(a,b){e.feedbackCategory=b,e.feedbackNote=a,e.feedbackNote&&e.feedbackNote.length&&h()},e.startFeedback=function(){function f(){function a(){p&&(g(),m=n,e.highlightblocks.push(m),o=!0)}function f(a,b){if(b&&!o){g();var c=b.getBoundingClientRect();m={type:e.highlight?"highlight":"blackout",time:Date.now(),top:c.top-2,left:c.left-2,width:c.width+6,height:c.height+6,pending:!0,hover:!0,zIndex:29999},e.highlightblocks.push(m),j(a)}}function g(a){for(var b=0;b<e.highlightblocks.length;b++)!e.highlightblocks[b].pending||a&&!e.highlightblocks[b].hover||e.highlightblocks.splice(b,1)}var h=v[0].getContext("2d");k(h);var m={},n={},o=!1,p=!1;e.highlight=!0;var r={},s=-1,w=-1;if(q.postBrowserInfo){r.browser={appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent,plugins:[]};for(var x=0;x<navigator.plugins.length;x++)r.browser.plugins.push(navigator.plugins[x].name)}q.postURL&&(r.url=document.URL),q.postTimeStamp&&(r.timestamp=Date.now()),q.postHTML&&(r.html=document.getElementsByTagName("html").innerHtml),e.onMouseDown=function(a){t&&!o&&(p=!0,s=a.pageX-v[0].getBoundingClientRect().left,w=a.pageY-v[0].getBoundingClientRect().top,n={type:e.highlight?"highlight":"blackout",time:Date.now(),top:w,left:s,width:0,height:0,zIndex:30002,pending:!0})},u.bind("mouseup",function(){if(p=!1,t&&o){o=!1;var a=m.top,c=m.left,d=m.width,f=m.height;(0===d||0===f)&&e.highlightblocks.pop(),0>d&&(c+=d,d*=-1),0>f&&(a+=f,f*=-1),a+f>b.innerHeight&&(f=b.innerHeight-a),c+d>b.innerWidth&&(d=b.innerWidth-c),m.top=a,m.left=c,m.width=d,m.height=f,m.pending=!1,j(h)}}),u.bind("mousemove",function(a){t&&o&&(m.width=a.pageX-v[0].getBoundingClientRect().left-s,m.height=a.pageY-v[0].getBoundingClientRect().top-w,j(h))}),e.removeBlock=function(a){e.highlightblocks.splice(a,1),j(h)},e.selectBlock=function(a){a.pageX===s&&a.pageY===w&&(m.pending=!1,m.hover=!1,m.zIndex=30002,j(h))},e.onHover=function(b){if(q.highlightElement&&t&&!o){if(p)return a();g(!0),j(h);for(var c,d=q.excludeTags.join("):not("),e=document.querySelectorAll("* :not("+d+")"),i=0;i<e.length;i++){var k=e[i].getBoundingClientRect();b.pageX>=k.left&&b.pageX<=k.left+k.width&&b.pageY>=k.top&&b.pageY<=k.top+k.height&&(c=e[i])}c&&f(h,c)}},e.redraw=function(){j(h)},angular.element(document.getElementsByTagName("body")).on("mouseleave",function(){j(h)}),e.removeElem=function(a,b){if(q.highlightElement&&b.id)for(var c=0;c<e.highlightblocks.length;c++)if(e.highlightblocks[c].id===b.id)return e.highlightblocks.slice(c,0),void j(h)},e.close=i,u.bind("keyup",function(a){27===a.keyCode&&i()}),u.bind("selectstart",function(a){a.preventDefault()}),u.bind("dragstart",function(a){a.preventDefault()}),e.backToWelcome=function(){t=!1,e.showCanvas=!1,e.showFeedbackHelpers=!1,e.showFeedbackHighlighter=!1,e.showWelcome=!0},e.setHighlight=function(a){return"boolean"!=typeof a?e.highlight:void(e.highlight=a)},e.takeScreenshot=function(){t=!1,c.scrollTo(0,0),e.showFeedbackHelpers=!1,e.showFeedbackHighlighter=!1,g(),e.highlightblocks.length?j(h):e.showCanvas=!1,q.screenshotStroke||j(h,!1),setTimeout(function(){html2canvas(document.body,{onrendered:function(a){e.showCanvas=!1,q.screenshotStroke||j(h),l=a.toDataURL(),c.scrollTo(0,0),r.img=l,e.screenshot=l,q.onScreenshotTaken(r.img),q.showDescriptionModal?e.showOverview=!0:i(),e.$apply()},proxy:q.proxy,letterRendering:q.letterRendering})},100)},e.backToHighlight=function(a){t=!0,e.showCanvas=!0,e.showOverview=!1,e.showFeedbackHelpers=!0,e.showFeedbackHighlighter=!0},e.submit=function(){if(t=!1,e.feedbackNote){e.feedbackButtonEnabled=!0,e.submitSuccess=!1,e.submitError=!1,e.showOverview=!1,r.img=l,r.note=e.feedbackNote,r.category=e.feedbackCategory;var a={feedback:r},b=JSON.stringify(a);d({url:"function"==typeof q.ajaxURL?q.ajaxURL():q.ajaxURL,method:"POST",data:b,headers:{"Content-Type":"application/json"},success:function(){e.submitSuccess=!0},error:function(){e.submitError=!0}})}}}e.start=!0,e.showWelcome=!0,s&&(e.feedbackButtonEnabled=!1),t=!1;var l="";g(),q.initialBox||h(),"undefined"==typeof html2canvas?a(q.html2canvasURL,f):f()}}}var f={restrict:"EA",scope:{options:"="},templateUrl:function(a,b){return b.template||"angularsendfeedback.html"},link:e};return f}angular.module("angular-send-feedback").directive("angularFeedback",b),b.$inject=["$document","$window","$http"]}();