/**
 * Angular feedback directive similar to Google Feedback
 * @version v1.2.2 - 2017-09-12 * @link https://github.com/pepperlabs/angular-feedback
 * @author Jacob Carter <jacob@ieksolutions.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function loadScript(a,b){var c,d,e;d=!1,c=document.createElement("script"),c.type="text/javascript",c.src=a,c.onload=c.onreadystatechange=function(){d||this.readyState&&"complete"!==this.readyState||(d=!0,b())},e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(c,e)}angular.module("templates-angularsendfeedback",["angularsendfeedback.html"]),angular.module("angularsendfeedback.html",[]).run(["$templateCache",function(a){a.put("angularsendfeedback.html","<div>\n  <div id=\"feedback-button\" ng-show='settings.feedbackButtonNative && feedbackButtonEnabled && !start'\n       ng-click='startFeedback()'>\n    <button class=\"feedback-btn feedback-btn-gray\">Send feedback</button>\n  </div>\n\n  <div id=\"feedback-module\" ng-show='start' ng-mousemove='moveWindow($event)' ng-style='feedbackModuleStyle'>\n"+'    <div id="feedback-submit-success" ng-if="submitSuccess">\n      <div class="feedback-logo">Feedback</div>\n      <p>Thank you for your feedback. We value every piece of feedback we receive.</p>\n      <p>We cannot respond individually to every one, but we will use your comments as we strive to improve your experience.</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>OK</button>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-submit-error" ng-if="submitError">\n      <div class="feedback-logo">Feedback</div>\n      <p>Sadly an error occurred while sending your feedback. Please try again.</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>OK</button>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-welcome" ng-if=\'showWelcome\'>\n      <div class="feedback-logo">Feedback</div>\n      <p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p>\n      <p>Start by writing a brief description:</p>\n      <textarea id="feedback-note-tmp" ng-model="feedbackNote"></textarea>\n      <p>Next we\'ll let you identify areas of the page related to your description.</p>\n      <button id="feedback-welcome-next" class="feedback-next-btn feedback-btn-gray"\n              ng-click=\'launchHighlight(feedbackNote)\' ng-disabled="!feedbackNote">Next</button>\n      <div id="feedback-welcome-error" ng-hide="feedbackNote">Please enter a description.</div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-highlighter" ng-show="showFeedbackHighlighter" ng-mousedown=\'trackHighlighter($event)\' \n      ng-mouseup=\'untrackHighlighter()\' ng-class=\'{"feedback-draggable":draggingHighlighter}\'\n      ng-style=\'feedbackHighlighterStyle\'>\n      <div class="feedback-logo">Feedback</div>\n      <p>Click and drag on the page to help us better understand your feedback. You can move this dialog if it\'s in the way.</p>\n      <button class="feedback-sethighlight" ng-mousedown=\'setHighlight(true)\' ng-class=\'{"feedback-active": highlight}\'>\n        <div class="ico"></div>\n        <span>Highlight</span>\n      </button>\n      <label>Highlight areas relevant to your feedback.</label>\n      <button class="feedback-setblackout" ng-mousedown=\'setHighlight(false)\' ng-class=\'{"feedback-active": !highlight}\'>\n        <div class="ico"></div>\n        <span>Black out</span>\n      </button>\n      <label class="lower">Black out any personal information.</label>\n      <div class="feedback-buttons">\n        <button id="feedback-highlighter-next" class="feedback-next-btn feedback-btn-gray"\n            ng-click=\'takeScreenshot()\'>Next</button>\n        <button id="feedback-highlighter-back" class="feedback-back-btn feedback-btn-gray" ng-click=\'backToWelcome()\' ng-show=\'settings.initialBox\'>Back</button>\n      </div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-overview" ng-show="showOverview">\n      <div class="feedback-logo">Feedback</div>\n      <div id="feedback-overview-description">\n        <div id="feedback-overview-description-text">\n          <h3>Description</h3>\n          <textarea id="feedback-overview-note" ng-model="feedbackNote"></textarea>\n\n          <h3 class="feedback-additional">Additional info</h3>\n          <div id="feedback-additional-none" ng-show=\'!settings.postBrowserInfo&&!settings.pageInfo&&!settings.postHTML&&!settings.postTimeStamp\'>\n            <span>None</span>\n          </div>\n          <div id="feedback-browser-info" ng-show=\'settings.postBrowserInfo\'>\n            <span>Browser Info</span>\n          </div>\n          <div id="feedback-page-info" ng-show=\'settings.pageInfo\'>\n            <span>Page Info</span>\n          </div>\n          <div id="feedback-timestamp" ng-show=\'settings.postTimeStamp\'>\n            <span>Time Stamp</span>\'\n          </div>\n          <div id="feedback-page-structure" ng-show=\'settings.postHTML\'>\n            <span>Page Structure</span>\n          </div>\n        </div>\n      </div>\n      <div id="feedback-overview-screenshot">\n        <h3>Screenshot</h3>\n        <img class="feedback-screenshot" ng-src="{{screenshot}}"/>\n      </div>\n      <div class="feedback-buttons">\n        <button id="feedback-submit" class="feedback-submit-btn feedback-btn-blue"\n                ng-click="submit()">Submit</button>\n        <button id="feedback-overview-back" class="feedback-back-btn feedback-btn-gray" ng-click=\'backToHighlight()\'>Back</button>\n      </div>\n      <div id="feedback-overview-error">Please enter a description.</div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n    <canvas id="feedback-canvas" ng-mousemove=\'onHover($event)\' ng-mouseup=\'selectBlock($event)\'\n            ng-mousedown=\'onMouseDown($event)\' ng-mouseleave=\'redraw()\' ng-style=\'canvasStyle\'></canvas>\n\n    <div id="feedback-helpers" ng-show=\'showFeedbackHelpers\'>\n      <div ng-repeat="item in highlightblocks" class="feedback-helper"\n           ng-mouseover=\'item.showRemove = true\' ng-mouseleave=\'item.showRemove = false\'\n           ng-style="{\'top\': item.top + \'px\', \n                      \'left\': item.left + \'px\',\n                      \'width\': item.width + \'px\',\n                      \'height\': item.height + \'px\',\n                      \'z-index\': item.zIndex\n                     }">\n        <div class="feedback-close" ng-style="item.styleClose" ng-click="removeBlock($index)" ng-show="item.showRemove"></div>\n\n      </div>\n    </div>\n    <input id="feedback-note" name="feedback-note" type="hidden" ng-model="feedbackNote">\n  </div>\n</div>\n')}]),angular.module("angular-send-feedback",[]).directive("angularFeedback",["$document","$window","$http",function(a,b,c){return{restrict:"EA",scope:{options:"="},templateUrl:function(a,b){return b.template||"angular-send-feedback/src/angularsendfeedback.html"},link:function(d){function e(){p=!1,d.feedbackButtonEnabled=!0,d.start=!1,m.onClose.call(this)}function f(a,b){b="undefined"!=typeof b?b:!0,g(a),i(a),j(a),k(a)}function g(a){a.clearRect(0,0,r[0].offsetWidth,r[0].offsetHeight),a.fillStyle="rgba(102,102,102,0.5)",a.fillRect(0,0,r[0].offsetWidth,r[0].offsetHeight)}function h(a,b,c,d,e){a.strokeStyle=m.strokeStyle,a.shadowColor=m.shadowColor,a.shadowOffsetX=m.shadowOffsetX,a.shadowOffsetY=m.shadowOffsetY,a.shadowBlur=m.shadowBlur,a.lineJoin=m.lineJoin,a.lineWidth=m.lineWidth,a.strokeRect(b,c,d,e),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}function i(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"highlight"===b.type&&h(a,b.left,b.top,b.width,b.height)}function j(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"highlight"===b.type&&a.clearRect(b.left,b.top,b.width,b.height)}function k(a){var b,c;for(c=0;c<d.highlightblocks.length;c++)b=d.highlightblocks[c],"blackout"===b.type&&(b.pending?a.fillStyle="rgba(0,0,0,0.5)":a.fillStyle="rgba(0,0,0,1)",a.fillRect(b.left,b.top,b.width,b.height))}var l=d.options,m=angular.extend({ajaxURL:"",postBrowserInfo:!0,postHTML:!0,postURL:!0,postTimeStamp:!0,proxy:void 0,letterRendering:!1,initButtonText:"Send feedback",strokeStyle:"black",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:3,html2canvasURL:"html2canvas.js",feedbackButton:".feedback-btn",feedbackButtonNative:!0,showDescriptionModal:!0,isDraggable:!0,excludeTags:["body","script","iframe","div","section","canvas",".feedback-btn","#feedback-module"],onScreenshotTaken:function(){},tpl:{initButton:"initButton",description:"description",highlighter:"highlighter",overview:"overview",submitSuccess:"submitSuccess",submitError:"submitError"},onClose:function(){},screenshotStroke:!0,highlightElement:!0,initialBox:!0},l);d.settings=m;var n=!!window.HTMLCanvasElement,o=".feedback-btn"===m.feedbackButton;d.highlightblocks=[];var p;if(n){var q=angular.element(a);d.feedbackButtonEnabled=!0,d.start=!1;var r=angular.element(document.getElementById("feedback-canvas"));d.feedbackHighlighterStyle={},d.canvasStyle={},d.launchHighlight=function(a){d.feedbackNote=a,d.feedbackNote&&d.feedbackNote.length&&(p=!0,d.canvasStyle.cursor="crosshair",d.showFeedbackHelpers=!0,d.showWelcome=!1,d.showFeedbackHighlighter=!0)},d.startFeedback=function(){function h(){function h(){t&&(k(),n=o,d.highlightblocks.push(n),s=!0)}function j(a,b){if(b&&!s){k(),d.canvasStyle.cursor="pointer";var c=b.getBoundingClientRect();n={type:d.highlight?"highlight":"blackout",time:Date.now(),top:c.top-2,left:c.left-2,width:c.width+6,height:c.height+6,pending:!0,hover:!0,zIndex:29999},d.highlightblocks.push(n),f(a)}}function k(a){for(var b=0;b<d.highlightblocks.length;b++)!d.highlightblocks[b].pending||a&&!d.highlightblocks[b].hover||d.highlightblocks.splice(b,1)}var l=r[0].getContext("2d");g(l);var n={},o={},s=!1,t=!1;d.highlight=1;var u={},v=-1,w=-1;m.postBrowserInfo&&(u.browser={appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent,plugins:[]},angular.forEach(navigator.plugins,function(a){u.browser.plugins.push(a.name)})),m.postURL&&(u.url=document.URL),m.postTimeStamp&&(u.timestamp=(new Date).getTime()),m.postHTML&&(u.html=angular.element(document.getElementsByTagName("html")).innerHtml),d.onMouseDown=function(a){p&&!s&&(t=!0,v=a.pageX-r[0].getBoundingClientRect().left,w=a.pageY-r[0].getBoundingClientRect().top,o={type:d.highlight?"highlight":"blackout",time:Date.now(),top:w,left:v,width:0,height:0,zIndex:30002,pending:!0})},q.bind("mouseup",function(){if(t=!1,p&&s){s=!1;var b=n.top,c=n.left,e=n.width,g=n.height;(0===e||0===g)&&d.highlightblocks.pop(),0>e&&(c+=e,e*=-1),0>g&&(b+=g,g*=-1),b+g>a.innerHeight&&(g=a.innerHeight-b),c+e>a.innerWidth&&(e=a.innerWidth-c),n.top=b,n.left=c,n.width=e,n.height=g,n.pending=!1,f(l)}}),q.bind("mousemove",function(a){p&&s&&(d.feedbackHighlighterStyle.cursor="default",n.width=a.pageX-r[0].getBoundingClientRect().left-v,n.height=a.pageY-r[0].getBoundingClientRect().top-w,f(l))}),d.removeBlock=function(a){d.highlightblocks.splice(a,1),f(l)},d.selectBlock=function(a){a.pageX===v&&a.pageY===w&&(n.pending=!1,n.hover=!1,n.zIndex=30002,f(l))},d.onHover=function(a){if(m.highlightElement&&p&&!s){if(t)return h();k(!0),f(l),d.canvasStyle.cursor="crosshair";for(var b,c=m.excludeTags.join("):not("),e=document.querySelectorAll("* :not("+c+")"),g=0;g<e.length;g++){var i=e[g].getBoundingClientRect();a.pageX>=i.left&&a.pageX<=i.left+i.width&&a.pageY>=i.top&&a.pageY<=i.top+i.height&&(b=e[g])}b&&j(l,b)}},d.redraw=function(){f(l)},angular.element(document.getElementsByTagName("body")).on("mouseleave",function(){f(l)}),d.removeElem=function(a,b){if(m.highlightElement&&b.id)for(var c=0;c<d.highlightblocks.length;c++)if(d.highlightblocks[c].id===b.id)return d.highlightblocks.slice(c,0),void f(l)},d.close=e,q.bind("keyup",function(a){27===a.keyCode&&e()}),q.bind("selectstart",function(a){a.preventDefault()}),q.bind("dragstart",function(a){a.preventDefault()}),d.backToWelcome=function(){p=!1,d.canvasStyle.cursor="default",d.showFeedbackHelpers=!1,d.showFeedbackHighlighter=!1,d.showWelcome=!0},d.setHighlight=function(a){d.highlight=a?1:0},d.takeScreenshot=function(){p=!1,d.canvasStyle.cursor="default",b.scrollTo(0,0),d.showFeedbackHelpers=!1,d.showFeedbackHighlighter=!1,m.screenshotStroke||f(l,!1),setTimeout(function(){html2canvas(document.body,{onrendered:function(a){m.screenshotStroke||f(l),i=a.toDataURL(),b.scrollTo(0,0),u.img=i,d.screenshot=i,m.onScreenshotTaken(u.img),m.showDescriptionModal?d.showOverview=!0:e(),d.$apply()},proxy:m.proxy,letterRendering:m.letterRendering})},100)},d.backToHighlight=function(a){p=!0,angular.element("#feedback-canvas").css("cursor","crosshair"),angular.element("#feedback-overview").hide(),angular.element("#feedback-helpers").show(),angular.element("#feedback-highlighter").show(),angular.element("#feedback-overview-error").hide()},d.submit=function(){if(p=!1,d.feedbackNote){d.submitSuccess=!1,d.submitError=!1,d.showOverview=!1,u.img=i,u.note=d.feedbackNote;var a={feedback:u},b=JSON.stringify(a);c.post({url:"function"==typeof m.ajaxURL?m.ajaxURL():m.ajaxURL,data:b,headers:{"Content-Type":"application/json"},success:function(){d.submitSuccess=!0},error:function(){d.submitError=!0}})}}}d.start=!0,d.showWelcome=!0,o&&(d.feedbackButtonEnabled=!1),p=!1;var i="",j=document.body.clientHeight,k=document.body.clientWidth;d.feedbackModuleStyle={position:"absolute",left:"0px",top:"0px"},d.canvasStyle["z-index"]=3e4,d.canvasStyle.width=k,d.canvasStyle.height=j,r.attr("width",k),r.attr("height",j),m.initialBox||(p=!0,d.canvasStyle.cursor="crosshair",d.showFeedbackHelpers=!0,d.showWelcome=!1,d.showFeedbackHighlighter=!0),"undefined"==typeof html2canvas?loadScript(m.html2canvasURL,h):h();var l,n,s,t;d.moving=!1,d.moveWindow=function(a){if(m.isDraggable&&d.moving){var c=a.pageY+l-s,e=a.pageX+n-t,f=s-a.pageY,g=t-a.pageX,h=angular.element(b)[0].offsetWidth,i=angular.element(b)[0].offsetHeight;0>e&&(e=0),0>c&&(c=0),g>h&&(e=h-t),e>h-t&&(e=h-t),f>i&&(c=i-s),c>i-s&&(c=i-s),d.feedbackHighlighterStyle.top=c+"px",d.feedbackHighlighterStyle.left=e+"px"}},d.trackHighlighter=function(a){m.isDraggable&&(d.moving=!0,d.draggingHighlighter=!0,s=a.target.offsetHeight,t=a.target.offsetWidth,l=a.target.getBoundingClientRect().top+s-a.pageY,n=a.target.getBoundingClientRect().left+t-a.pageX,d.feedbackHighlighterStyle["z-index"]=4e4,a.preventDefault())},d.untrackHighlighter=function(){m.isDraggable&&d.moving&&(d.moving=!1,d.draggingHighlighter=!1)}}}}}}]);