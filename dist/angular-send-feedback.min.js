/**
 * Angular feedback directive similar to Google Feedback
 * @version v1.2.2 - 2017-09-10 * @link https://github.com/pepperlabs/angular-feedback
 * @author Jacob Carter <jacob@ieksolutions.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function loadScript(a,b){var c,d,e;d=!1,c=document.createElement("script"),c.type="text/javascript",c.src=a,c.onload=c.onreadystatechange=function(){d||this.readyState&&"complete"!==this.readyState||(d=!0,b())},e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(c,e)}angular.module("templates-angularsendfeedback",["angularsendfeedback.html"]),angular.module("angularsendfeedback.html",[]).run(["$templateCache",function(a){a.put("angularsendfeedback.html",'<div>\n  <div id="feedback-button" ng-if=\'settings.feedbackButtonNative && feedbackButtonEnabled && !start\' ng-click=\'startFeedback()\'>\n    <button class="feedback-btn feedback-btn-gray">Send feedback</button>\n  </div>\n  <div id="feedback-module" ng-show=\'start\' ng-mousemove=\'moveWindow($event)\'>\n    <div id="feedback-submit-success" ng-if="submitSuccess">\n      <div class="feedback-logo">Feedback</div>\n      <p>Thank you for your feedback. We value every piece of feedback we receive.</p>\n      <p>We cannot respond individually to every one, but we will use your comments as we strive to improve your experience.</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>OK</button>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-submit-error" ng-if="submitError">\n      <div class="feedback-logo">Feedback</div>\n      <p>Sadly an error occurred while sending your feedback. Please try again.</p>\n      <button class="feedback-close-btn feedback-btn-blue" ng-click=\'close()\'>OK</button>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-welcome" ng-if=\'!hideWelcome\'>\n      <div class="feedback-logo">Feedback</div>\n      <p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p>\n      <p>Start by writing a brief description:</p>\n      <textarea id="feedback-note-tmp"></textarea>\n      <p>Next we\'ll let you identify areas of the page related to your description.</p>\n      <button id="feedback-welcome-next" class="feedback-next-btn feedback-btn-gray" ng-click=\'launchHighlight()\'>Next</button>\n      <div id="feedback-welcome-error">Please enter a description.</div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-highlighter" ng-show="showFeedbackHighlighter" ng-mousedown=\'trackHighlighter($event)\' \n      ng-mouseup=\'untrackHighlighter()\' ng-class=\'{"feedback-draggable":draggingHighlighter}\'>\n      <div class="feedback-logo">Feedback</div>\n      <p>Click and drag on the page to help us better understand your feedback. You can move this dialog if it\'s in the way.</p>\n      <button class="feedback-sethighlight" ng-mousedown=\'setHighlight(true)\' ng-class=\'{"feedback-active": highlight}\'>\n        <div class="ico"></div>\n        <span>Highlight</span>\n      </button>\n      <label>Highlight areas relevant to your feedback.</label>\n      <button class="feedback-setblackout" ng-mousedown=\'setHighlight(false)\' ng-class=\'{"feedback-active": !highlight}\'>\n        <div class="ico"></div>\n        <span>Black out</span>\n      </button>\n      <label class="lower">Black out any personal information.</label>\n      <div class="feedback-buttons">\n        <button id="feedback-highlighter-next" class="feedback-next-btn feedback-btn-gray" ng-click=\'startHtml2Canvas()\'>Next</button>\n        <button id="feedback-highlighter-back" class="feedback-back-btn feedback-btn-gray" ng-click=\'backToWelcome()\' ng-show=\'settings.initialBox\'>Back</button>\n      </div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n\n    <div id="feedback-overview">\n      <div class="feedback-logo">Feedback</div>\n      <div id="feedback-overview-description">\n        <div id="feedback-overview-description-text">\n          <h3>Description</h3>\n          <h3 class="feedback-additional">Additional info</h3>\n          <div id="feedback-additional-none" ng-show=\'!settings.postBrowserInfo&&!settings.pageInfo&&!settings.postHTML&&!settings.postTimeStamp\'>\n            <span>None</span>\n          </div>\n          <div id="feedback-browser-info" ng-show=\'settings.postBrowserInfo\'>\n            <span>Browser Info</span>\n          </div>\n          <div id="feedback-page-info" ng-show=\'settings.pageInfo\'>\n            <span>Page Info</span>\n          </div>\n          <div id="feedback-timestamp" ng-show=\'settings.postTimeStamp\'>\n            <span>Time Stamp</span>\'\n          </div>\n          <div id="feedback-page-structure" ng-show=\'settings.postHTML\'>\n            <span>Page Structure</span>\n          </div>\n        </div>\n      </div>\n      <div id="feedback-overview-screenshot">\n        <h3>Screenshot</h3>\n      </div>\n      <div class="feedback-buttons">\n        <button id="feedback-submit" class="feedback-submit-btn feedback-btn-blue">Submit</button>\n        <button id="feedback-overview-back" class="feedback-back-btn feedback-btn-gray" ng-click=\'backToHighlight()\'>Back</button>\n      </div>\n      <div id="feedback-overview-error">Please enter a description.</div>\n      <div class="feedback-wizard-close" ng-click=\'close()\'></div>\n    </div>\n    <canvas id="feedback-canvas" ng-mousemove=\'onMoveCanvas($event)\' ng-click=\'onMoveCanvas($event)\' ng-mousedown=\'startDragging($event)\' ng-mouseleave=\'redraw()\'></canvas>\n    <div id="feedback-helpers" ng-show=\'showFeedbackHelpers\'>\n\n    </div>\n    <input id="feedback-note" name="feedback-note" type="hidden">\n  </div>\n</div>\n')}]),angular.module("angular-send-feedback",["templates-angularsendfeedback"]),console.log("refactored"),angular.module("angular-send-feedback").directive("angularFeedback",["$document","$window",function(a,b){return{restrict:"EA",replace:!0,transclude:!0,scope:{options:"="},templateUrl:function(a,b){return b.template||"angularsendfeedback.html"},link:function(c,d,e){function f(){console.log("close"),m=!1,c.feedbackButtonEnabled=!0,c.start=!1,i(document).off("mouseenter mouseleave",".feedback-helper"),i(document).off("mouseup keyup"),i(document).off("mousedown",".feedback-setblackout"),i(document).off("mousedown",".feedback-sethighlight"),i(document).off("mousedown click","#feedback-close"),i(document).off("mousedown","#feedback-canvas"),i(document).off("click","#feedback-highlighter-next"),i(document).off("click","#feedback-highlighter-back"),i(document).off("click","#feedback-welcome-next"),i(document).off("click","#feedback-overview-back"),i(document).off("mouseleave","body"),i(document).off("mouseenter",".feedback-helper"),i(document).off("selectstart dragstart",document),i("#feedback-module").off("click",".feedback-wizard-close,.feedback-close-btn"),i(document).off("click","#feedback-submit"),k.highlightElement&&(i(document).off("click","#feedback-canvas"),i(document).off("mousemove","#feedback-canvas")),i('[data-highlighted="true"]').removeAttr("data-highlight-id").removeAttr("data-highlighted"),i("#feedback-module").remove(),i(".feedback-btn").show(),k.onClose.call(this)}function g(a,b){var c=angular.element("#feedback-canvas");b="undefined"!=typeof b?b:!0,a.clearRect(0,0,c.width(),c.height()),a.fillStyle="rgba(102,102,102,0.5)",a.fillRect(0,0,c.width(),c.height()),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&b&&h(a,parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&a.clearRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),i(".feedback-helper").each(function(){"blackout"===i(this).attr("data-type")&&(a.fillStyle="rgba(0,0,0,1)",a.fillRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height()))})}function h(a,b,c,d,e){a.strokeStyle=k.strokeStyle,a.shadowColor=k.shadowColor,a.shadowOffsetX=k.shadowOffsetX,a.shadowOffsetY=k.shadowOffsetY,a.shadowBlur=k.shadowBlur,a.lineJoin=k.lineJoin,a.lineWidth=k.lineWidth,a.strokeRect(b,c,d,e),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,a.lineWidth=1}var i=jQuery,j=c.options,k=angular.extend({ajaxURL:"",postBrowserInfo:!0,postHTML:!0,postURL:!0,postTimeStamp:!0,proxy:void 0,letterRendering:!1,initButtonText:"Send feedback",strokeStyle:"black",shadowColor:"black",shadowOffsetX:1,shadowOffsetY:1,shadowBlur:10,lineJoin:"bevel",lineWidth:3,html2canvasURL:"html2canvas.js",feedbackButton:".feedback-btn",feedbackButtonNative:!0,showDescriptionModal:!0,isDraggable:!0,onScreenshotTaken:function(){},tpl:{initButton:"initButton",description:"description",highlighter:"highlighter",overview:"overview",submitSuccess:"submitSuccess",submitError:"submitError"},onClose:function(){},screenshotStroke:!0,highlightElement:!0,initialBox:!0},j);c.settings=k;var l,m,n=!!window.HTMLCanvasElement,o=".feedback-btn"===k.feedbackButton;if(n){var p=angular.element(a);c.feedbackButtonEnabled=!0,c.start=!1,c.startFeedback=function(){function d(){var b=j[0].getContext("2d");b.fillStyle="rgba(102,102,102,0.5)",b.fillRect(0,0,j.width(),j.height());var d={},o=!1;c.highlight=1;var r={};if(k.postBrowserInfo&&(r.browser={appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent,plugins:[]},i.each(navigator.plugins,function(a){r.browser.plugins.push(navigator.plugins[a].name)})),k.postURL&&(r.url=document.URL),k.postTimeStamp&&(r.timestamp=(new Date).getTime()),k.postHTML&&(r.html=i("html").html()),c.startDragging=function(a){m&&(d.startX=a.pageX-i(this).offset().left,d.startY=a.pageY-i(this).offset().top,d.w=0,d.h=0,o=!0)},p.bind("mouseup",function(){if(!m){console.log("mouseup document"),o=!1;var e=d.startY,f=d.startX,h=d.w,j=d.h;l="highlight",0!==h&&0!==j&&(0>h&&(f+=h,h*=-1),0>j&&(e+=j,j*=-1),e+j>a.height()&&(j=a.height()-e),f+h>a.width()&&(h=a.width()-f),0===c.highlight&&(l="blackout"),i("#feedback-helpers").append('<div class="feedback-helper" data-type="'+l+'" data-time="'+Date.now()+'" style="position:absolute;top:'+e+"px;left:"+f+"px;width:"+h+"px;height:"+j+'px;z-index:30000;"></div>'),g(b),d.w=0)}}),p.bind("mousemove",function(a){m&&o&&(n.css("cursor","default"),d.w=a.pageX-j.offset().left-d.startX,d.h=a.pageY-j.offset().top-d.startY,b.clearRect(0,0,j.width(),j.height()),b.fillStyle="rgba(102,102,102,0.5)",b.fillRect(0,0,j.width(),j.height()),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&h(b,parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),1===c.highlight&&(h(b,d.startX,d.startY,d.w,d.h),b.clearRect(d.startX,d.startY,d.w,d.h)),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&b.clearRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),i(".feedback-helper").each(function(){"blackout"===i(this).attr("data-type")&&(b.fillStyle="rgba(0,0,0,1)",b.fillRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height()))}),0===c.highlight&&(b.fillStyle="rgba(0,0,0,0.5)",b.fillRect(d.startX,d.startY,d.w,d.h)))}),k.highlightElement){var t=[],u=[],v=0;c.onMoveCanvas=function(a){if(m){console.log("here? "),g(b),u=[],j.css("cursor","crosshair"),i("* :not(body,script,iframe,div,section,.feedback-btn,#feedback-module *)").each(function(){"true"!==i(this).attr("data-highlighted")&&a.pageX>i(this).offset().left&&a.pageX<i(this).offset().left+i(this).width()&&a.pageY>i(this).offset().top+parseInt(i(this).css("padding-top"),10)&&a.pageY<i(this).offset().top+i(this).height()+parseInt(i(this).css("padding-top"),10)&&u.push(i(this))});var e=u[u.length-1];if(e&&!o){j.css("cursor","pointer");var f=e.offset().left-2,k=e.offset().top-2,n=e.width()+parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10)+6,p=e.height()+parseInt(e.css("padding-top"),10)+parseInt(e.css("padding-bottom"),10)+6;1===c.highlight&&(h(b,f,k,n,p),b.clearRect(f,k,n,p),l="highlight"),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&b.clearRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),0===c.highlight&&(l="blackout",b.fillStyle="rgba(0,0,0,0.5)",b.fillRect(f,k,n,p)),i(".feedback-helper").each(function(){"blackout"===i(this).attr("data-type")&&(b.fillStyle="rgba(0,0,0,1)",b.fillRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height()))}),"click"===a.type&&a.pageX===d.startX&&a.pageY===d.startY&&(i("#feedback-helpers").append('<div class="feedback-helper" data-highlight-id="'+v+'" data-type="'+l+'" data-time="'+Date.now()+'" style="position:absolute;top:'+k+"px;left:"+f+"px;width:"+n+"px;height:"+p+'px;z-index:30000;"></div>'),t.push(v),++v,g(b))}}}}c.redraw=function(){g(b)},p.bind("mouseleave","body",function(){g(b)}),p.bind("mouseenter",".feedback-helper",function(){g(b)}),c.launchHighlight=function(){console.log("yolo"),i("#feedback-note").val().length>0?(m=!0,j.css("cursor","crosshair"),c.showFeedbackHelpers=!0,c.hideWelcome=!0,n.show(),c.showFeedbackHighlighter=!0):i("#feedback-welcome-error").show()},p.bind("mouseenter mouseleave",".feedback-helper",function(a){if(!o){if(console.log("hhhhh"),d.w=0,d.h=0,"mouseenter"!==a.type)return i(this).css("z-index","30000"),i(this).children().remove(),void("blackout"===i(this).attr("data-type")&&g(b));if(i(this).css("z-index","30001"),i(this).append('<div class="feedback-helper-inner" style="width:'+(i(this).width()-2)+"px;height:"+(i(this).height()-2)+'px;position:absolute;margin:1px;"></div>'),i(this).append('<div id="feedback-close"></div>'),i(this).find("#feedback-close").css({top:-1*(i(this).find("#feedback-close").height()/2)+"px",left:i(this).width()-i(this).find("#feedback-close").width()/2+"px"}),"blackout"===i(this).attr("data-type")){b.clearRect(0,0,i("#feedback-canvas").width(),i("#feedback-canvas").height()),b.fillStyle="rgba(102,102,102,0.5)",b.fillRect(0,0,i("#feedback-canvas").width(),i("#feedback-canvas").height()),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&h(b,parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),i(".feedback-helper").each(function(){"highlight"===i(this).attr("data-type")&&b.clearRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())}),b.clearRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height()),b.fillStyle="rgba(0,0,0,0.75)",b.fillRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height());var c=i(this).attr("data-time");i(".feedback-helper").each(function(){return i(this).attr("data-time")===c?!0:void("blackout"===i(this).attr("data-type")&&(b.fillStyle="rgba(0,0,0,1)",b.fillRect(parseInt(i(this).css("left"),10),parseInt(i(this).css("top"),10),i(this).width(),i(this).height())))})}}}),i(document).on("click","#feedback-close",function(){if(k.highlightElement&&i(this).parent().attr("data-highlight-id"))var a=i(this).parent().attr("data-highlight-id");i(this).parent().remove(),k.highlightElement&&a&&i('[data-highlight-id="'+a+'"]').removeAttr("data-highlighted").removeAttr("data-highlight-id"),g(b)}),c.close=f,p.bind("keyup",function(a){27===a.keyCode&&f()}),p.bind("selectstart",function(a){a.preventDefault()}),p.bind("dragstart",function(a){a.preventDefault()}),c.backToWelcome=function(){m=!1,j.css("cursor","default"),i("#feedback-helpers").hide(),console.log("click high back"),i("#feedback-highlighter").hide(),i("#feedback-welcome-error").hide(),i("#feedback-welcome").show()},c.setHighlight=function(a){c.highlight=a?1:0},c.startHtml2Canvas=function(){console.log("startHTML2Canvas"),m=!1,j.css("cursor","default");var a=i(document).scrollTop(),c=i(window).height();i("#feedback-helpers").hide(),console.log("click high next"),i("#feedback-highlighter").hide(),k.screenshotStroke||g(b,!1),html2canvas(angular.element("body"),{onrendered:function(d){console.log("rendered"),k.screenshotStroke||g(b);var h=i('<canvas id="feedback-canvas-tmp" width="'+s+'" height="'+c+'"/>').hide().appendTo("body"),j=h.get(0).getContext("2d");j.drawImage(d,0,a,s,c,0,0,s,c),q=h.get(0).toDataURL(),i(document).scrollTop(a),r.img=q,k.onScreenshotTaken(r.img),k.showDescriptionModal?(i("#feedback-canvas-tmp").remove(),i("#feedback-overview").show(),i("#feedback-overview-description-text>textarea").remove(),i("#feedback-overview-screenshot>img").remove(),i('<textarea id="feedback-overview-note">'+i("#feedback-note").val()+"</textarea>").insertAfter("#feedback-overview-description-text h3:eq(0)"),i("#feedback-overview-screenshot").append('<img class="feedback-screenshot" src="'+q+'" />')):(console.log("remove feedback-module"),e.remove(),f(),h.remove())},proxy:k.proxy,letterRendering:k.letterRendering})},c.backToHighlight=function(a){m=!0,console.log("backToHighlight"),i("#feedback-canvas").css("cursor","crosshair"),i("#feedback-overview").hide(),i("#feedback-helpers").show(),i("#feedback-highlighter").show(),i("#feedback-overview-error").hide()},i(document).on("keyup","#feedback-note-tmp,#feedback-overview-note",function(a){var b;"feedback-note-tmp"===a.target.id?b=i("#feedback-note-tmp").val():(b=i("#feedback-overview-note").val(),i("#feedback-note-tmp").val(b)),i("#feedback-note").val(b)}),i(document).on("click","#feedback-submit",function(){if(m=!1,i("#feedback-note").val().length>0){i("#feedback-submit-success,#feedback-submit-error").remove(),i("#feedback-overview").hide(),r.img=q,r.note=i("#feedback-note").val();var a={feedback:r},b=JSON.stringify(a);i.ajax({url:"function"==typeof k.ajaxURL?k.ajaxURL():k.ajaxURL,dataType:"json",contentType:"application/json",type:"POST",data:b,headers:{"Content-Type":"application/json"},success:function(){c.submitSuccess=!0},error:function(){c.submitError=!0}})}else i("#feedback-overview-error").show()})}console.log("true !"),c.start=!0,c.hideWelcome=!1,o&&(c.feedbackButtonEnabled=!1);var e=angular.element("#feedback-module"),j=angular.element("#feedback-canvas"),n=angular.element("#feedback-highlighter");console.log("start",c.start),m=!1;var q="",r=a.height(),s=a.width(),t={position:"absolute",left:"0px",top:"0px"},u={width:s,height:r};console.log("feebackCanvas",j),e.css(t),j.attr(u).css("z-index","30000"),k.initialBox||(console.log("no initial box"),m=!0,j.css("cursor","crosshair"),c.showFeedbackHelpers=!0,c.hideWelcome=!0,c.showFeedbackHighlighter=!0),"undefined"==typeof html2canvas?loadScript(k.html2canvasURL,d):d();var v,w,x,y;c.moving=!1,c.moveWindow=function(a){if(k.isDraggable&&c.moving){console.log("move window");var d=a.pageY+v-x,e=a.pageX+w-y,f=x-a.pageY,g=y-a.pageX,h=angular.element(b).width(),i=angular.element(b).height();0>e&&(e=0),0>d&&(d=0),g>h&&(e=h-y),e>h-y&&(e=h-y),f>i&&(d=i-x),d>i-x&&(d=i-x),n.offset({top:d,left:e})}},c.trackHighlighter=function(a){k.isDraggable&&(console.log("trackHighlighter"),c.moving=!0,c.draggingHighlighter=!0,x=n.outerHeight(),y=n.outerWidth(),v=n.offset().top+x-a.pageY,w=n.offset().left+y-a.pageX,n.css("z-index",4e4),a.preventDefault())},c.untrackHighlighter=function(){k.isDraggable&&c.moving&&(console.log("untrackHighlighter"),c.moving=!1,c.draggingHighlighter=!1)}}}}}}]);